<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Inteligente</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-mapa.css">
    <link rel="stylesheet" href="styles-variables.css">
    <link rel="stylesheet" href="styles-professional-enhancements.css">
    <!-- Enhanced Select Styling -->
    <link rel="stylesheet" href="styles-select.css">
    <!-- FullCalendar CSS -->
    <link id="fc-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" onerror="this.onerror=null; this.href='https://unpkg.com/fullcalendar@5.11.3/main.min.css'">
    <!-- Mobile Override - Debe ser el Ãºltimo para tener mÃ¡xima prioridad -->
    <link rel="stylesheet" href="styles-mobile-override.css">
    <!-- Floating Action Button (FAB) -->
    <link rel="stylesheet" href="styles-fab.css">
</head>
<body>
    <!-- Vista de AutenticaciÃ³n -->
    <main id="authView" class="auth-view">
        <div class="auth-card">
            <div class="auth-header">
                <img src="assets/logo.svg" alt="Logo" class="auth-logo">
                <h1>Calendario Inteligente</h1>
                <p>Planifica tus tareas de manera eficiente</p>
            </div>
            <form id="loginForm" class="auth-form">
                <div class="input-group">
                    <label for="loginEmail">Correo electrÃ³nico</label>
                    <input type="email" id="loginEmail" placeholder="demo@demo.com" required>
                </div>
                <div class="input-group">
                    <label for="loginPassword">ContraseÃ±a</label>
                    <input type="password" id="loginPassword" placeholder="demo123" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Iniciar SesiÃ³n</button>
                <p class="auth-hint">
                    <strong>Demo:</strong> demo@demo.com / demo123
                </p>
            </form>
        </div>
    </main>

    <!-- Vista de AplicaciÃ³n -->
    <div id="appView" class="app-view" style="display:none;">
        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-left">
                <button id="toggleSidebar" class="btn-icon" title="MenÃº" aria-label="Abrir o cerrar menÃº de navegaciÃ³n">â˜°</button>
                
                <h1 class="topbar-title">Calendario Inteligente</h1>
            </div>
            <div class="topbar-right">
                <button id="helpButton" class="btn-icon" title="Ayuda (?)" aria-label="Abrir ventana de ayuda">â“</button>
                <div class="user-menu-wrapper">
                    <button id="profileMenuBtn" class="profile-menu-btn" title="MenÃº de perfil" aria-label="MenÃº de usuario">
                        <img src="assets/avatar.png" alt="Avatar" class="user-avatar">
                    </button>
                    <div id="profileDropdown" class="profile-dropdown" style="display: none;">
                        <div class="profile-dropdown-header">
                            <img src="assets/avatar.png" alt="Avatar" class="dropdown-avatar">
                            <span id="userEmailDropdown" class="dropdown-email">usuario@ejemplo.com</span>
                        </div>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item" data-action="settings">
                            <span class="dropdown-icon">âš™ï¸</span>
                            <span class="dropdown-text">Ajustes</span>
                        </a>
                        <a href="#" class="dropdown-item" data-action="help">
                            <span class="dropdown-icon">â“</span>
                            <span class="dropdown-text">Consultas</span>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item logout-item" data-action="logout">
                            <span class="dropdown-icon">ğŸšª</span>
                            <span class="dropdown-text">Cerrar SesiÃ³n</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="app-container">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar">
                <nav class="sidebar-nav">
                    <a href="#" data-view="dashboard" data-tooltip="Dashboard" class="nav-item active">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span class="nav-label">Dashboard</span>
                    </a>
                    <a href="#" data-view="calendar" data-tooltip="Calendario" class="nav-item">
                        <span class="nav-icon">ğŸ“†</span>
                        <span class="nav-label">Calendario</span>
                    </a>
                    <a href="#" data-view="tasks" data-tooltip="Tareas" class="nav-item">
                        <span class="nav-icon">âœ“</span>
                        <span class="nav-label">Tareas</span>
                    </a>
                    <a href="#" data-view="routePlanner" data-tooltip="Rutas" class="nav-item">
                        <span class="nav-icon">ğŸ—ºï¸</span>
                        <span class="nav-label">Rutas</span>
                    </a>
                    <a href="#" data-view="settings" data-tooltip="ConfiguraciÃ³n" class="nav-item">
                        <span class="nav-icon">âš™ï¸</span>
                        <span class="nav-label">ConfiguraciÃ³n</span>
                    </a>
                </nav>
            </aside>
            <div id="sidebarOverlay" class="sidebar-overlay" hidden></div>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard View -->
                <section id="viewDashboard" class="content-view active">
                    <div class="dashboard-header">
                        <h2>ğŸ“Š Dashboard</h2>
                        <button id="btnRouteRecommendations" class="btn btn-brand" onclick="showRouteRecommendations()">
                            ğŸ—ºï¸ Ver Recomendaciones de Rutas
                        </button>
                    </div>

                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>ğŸ“‹ Tareas Pendientes</h3>
                            <div id="dashboardUnassignedTasks" class="task-list"></div>
                        </div>

                        <div class="card">
                            <h3>ğŸ’¡ Sugerencias del DÃ­a</h3>
                            <div id="dashboardSuggestions" class="suggestions-list"></div>
                        </div>
                    </div>
                </section>

                <!-- Calendar View -->
                <section id="viewCalendar" class="content-view">
                    <div class="card calendar-card">
                        <div class="calendar-card-header">
                            <div class="calendar-header-content">
                                <div class="calendar-actions-left">
                                    <button id="addTaskFromCalendar" class="btn btn-primary btn-sm calendar-btn">
                                        <span class="btn-icon-inline">â•</span>
                                        Nueva tarea
                                    </button>
                                    <div class="calendar-nav-controls">
                                        <button id="calendarPrev" class="btn-calendar-nav" title="Anterior">
                                            <span>â€¹</span>
                                        </button>
                                        <button id="calendarToday" class="btn-calendar-today" title="Ir a hoy">
                                            Hoy
                                        </button>
                                        <button id="calendarNext" class="btn-calendar-nav" title="Siguiente">
                                            <span>â€º</span>
                                        </button>
                                    </div>
                                    <div class="calendar-view-switcher">
                                        <button id="viewListWeek" class="btn-view" title="Lista de 5 dÃ­as">
                                            <span>â˜°</span>
                                        </button>
                                        <button id="viewTimeDay" class="btn-view active" title="Vista dÃ­a">
                                            <span>ğŸ“…</span>
                                        </button>
                                        <button id="viewTimeWeek" class="btn-view" title="Vista semana">
                                            <span>ğŸ“†</span>
                                        </button>
                                    </div>
                                    <button id="optimizeTodayRoute" class="btn btn-success btn-sm calendar-btn" title="Optimizar ruta de hoy con trÃ¡fico" onclick="optimizeTodayRoute()">
                                        <span class="btn-icon-inline">âš¡</span>
                                        Optimizar
                                    </button>
                                </div>

                                <div class="calendar-legend-header">
                                    <span class="legend-label">Prioridades:</span>
                                    <div class="legend-items">
                                        <span class="legend-badge">
                                            <span class="legend-dot priority-work"></span>
                                            <span class="legend-text">Trabajo</span>
                                        </span>
                                        <span class="legend-badge">
                                            <span class="legend-dot priority-urgent"></span>
                                            <span class="legend-text">Urgente</span>
                                        </span>
                                        <span class="legend-badge">
                                            <span class="legend-dot priority-important"></span>
                                            <span class="legend-text">Importante</span>
                                        </span>
                                        <span class="legend-badge">
                                            <span class="legend-dot priority-personal"></span>
                                            <span class="legend-text">Personal</span>
                                        </span>
                                        <span class="legend-badge">
                                            <span class="legend-dot priority-neutral"></span>
                                            <span class="legend-text">Neutro</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="calendar-card-content">
                            <div id="fullcalendar" class="fullcalendar-container"></div>
                        </div>
                    </div>
                </section>

                <!-- Tasks View -->
                <section id="viewTasks" class="content-view">
                    <h2>âœ“ GestiÃ³n de Tareas</h2>

                    <div class="card">
                        <h3>â• AÃ±adir Nueva Tarea</h3>
                        <form id="taskForm">
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="taskName">Nombre de la tarea:</label>
                                    <input type="text" id="taskName" placeholder="Ej: Comprar verduras" required>
                                </div>

                                <div class="input-group">
                                    <label for="taskDuration">DuraciÃ³n (horas):</label>
                                    <input type="number" id="taskDuration" min="0.25" max="24" step="0.25" value="1" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="input-group autocomplete-wrapper">
                                    <label for="taskLocation">UbicaciÃ³n/Lugar:</label>
                                    <input type="text" id="taskLocation" placeholder="Ej: Supermercado Centro" required autocomplete="off">
                                    <div id="taskLocationSuggestions" class="autocomplete-suggestions"></div>
                                    <button type="button" id="selectFromMap" class="btn btn-secondary btn-sm" style="margin-top: 8px;">
                                        ğŸ“ Seleccionar en el mapa
                                    </button>
                                </div>

                                <div class="input-group">
                                    <label for="taskPriority">âš¡ Nivel de Prioridad</label>
                                    <select id="taskPriority" required aria-label="Selecciona el nivel de prioridad de la tarea">
                                        <option value="baja">ğŸŸ¢ Baja</option>
                                        <option value="media" selected>ğŸŸ¡ Media</option>
                                        <option value="alta">ğŸŸ  Alta</option>
                                        <option value="urgente">ğŸ”´ Urgente</option>
                                    </select>
                                    <small class="select-helper">Define la importancia de esta tarea</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="input-group">
                                    <label for="taskDeadline">Fecha lÃ­mite (opcional):</label>
                                    <input type="text" id="taskDeadline" placeholder="DD-MM-YYYY" maxlength="10">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="input-group">
                                    <label for="taskWindowStart">Ventana inicio (opcional):</label>
                                    <input type="text" id="taskWindowStart" placeholder="DD-MM-YYYY" maxlength="10">
                                </div>

                                <div class="input-group">
                                    <label for="taskWindowEnd">Ventana fin (opcional):</label>
                                    <input type="text" id="taskWindowEnd" placeholder="DD-MM-YYYY" maxlength="10">
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success">AÃ±adir Tarea</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‹ Tareas Pendientes (Sin Asignar)</h3>
                        <div id="unassignedTasks" class="task-list"></div>
                    </div>

                    <div class="card">
                        <h3>ğŸ’¡ Sugerencias Inteligentes</h3>
                        <p style="color: var(--text-muted); margin-bottom: 16px;">
                            El sistema analiza tus tareas y sugiere la mejor manera de agruparlas para ahorrar tiempo.
                        </p>
                        <div id="suggestions" class="suggestions-list"></div>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‹ Todas las Tareas</h3>
                        <div id="allTasks" class="all-tasks-list"></div>
                    </div>

                    <div id="archivedInfo"></div>
                </section>

                <!-- Settings View -->
                <section id="viewSettings" class="content-view">
                    <h2>âš™ï¸ ConfiguraciÃ³n</h2>

                    <div class="card">
                        <h3>ğŸ“ Ubicaciones</h3>
                        <div class="locations-section">
                            <div class="location-card">
                                <h4>ğŸ  Casa</h4>
                                <div class="input-group autocomplete-wrapper">
                                    <label for="homeAddress">DirecciÃ³n de casa:</label>
                                    <input type="text" id="homeAddress" placeholder="Ej: Calle Principal 123, Ciudad" autocomplete="off">
                                    <div id="homeAddressSuggestions" class="autocomplete-suggestions"></div>
                                </div>
                                <button id="detectHome" class="btn btn-secondary">ğŸ“ Detectar mi ubicaciÃ³n actual</button>
                                <div id="homeCoords" class="coords-display"></div>
                            </div>

                            <div class="location-card">
                                <h4>ğŸ’¼ Trabajo</h4>
                                <div class="input-group autocomplete-wrapper">
                                    <label for="workAddress">DirecciÃ³n del trabajo:</label>
                                    <input type="text" id="workAddress" placeholder="Ej: Avenida Empresarial 456, Ciudad" autocomplete="off">
                                    <div id="workAddressSuggestions" class="autocomplete-suggestions"></div>
                                </div>
                                <button id="detectWork" class="btn btn-secondary">ğŸ“ Detectar mi ubicaciÃ³n actual</button>
                                <div id="workCoords" class="coords-display"></div>
                            </div>

                            <div class="location-card">
                                <h4>â±ï¸ Tiempos de traslado</h4>
                                <div class="input-group">
                                    <label for="homeToWork">Casa â†’ Trabajo (minutos):</label>
                                    <input type="number" id="homeToWork" min="0" step="5" placeholder="Ej: 30">
                                </div>
                                <div class="input-group">
                                    <label for="workToHome">Trabajo â†’ Casa (minutos):</label>
                                    <input type="number" id="workToHome" min="0" step="5" placeholder="Ej: 35">
                                </div>
                                <button id="calculateCommute" class="btn btn-primary">ğŸš— Calcular automÃ¡ticamente</button>
                            </div>
                        </div>
                        <button id="saveLocations" class="btn btn-success btn-large">Guardar Ubicaciones</button>
                        <div id="locationInfo" class="info-box"></div>
                    </div>

                    <div class="card">
                        <h3>â° Horario Laboral</h3>
                        <div class="work-schedule">
                            <div class="input-group">
                                <label for="workStart">Hora de inicio:</label>
                                <input type="time" id="workStart" value="08:00">
                            </div>
                            <div class="input-group">
                                <label for="workEnd">Hora de fin:</label>
                                <input type="time" id="workEnd" value="17:30">
                            </div>
                            <button id="saveWorkSchedule" class="btn btn-primary">Guardar Horario</button>
                        </div>
                        <div id="scheduleInfo" class="info-box"></div>
                    </div>

                    <div class="card">
                        <h3>ğŸš— Medio de Transporte Preferido</h3>
                        <div class="transport-options">
                            <div class="input-group">
                                <label for="transportMode">ğŸš— Medio de Transporte</label>
                                <select id="transportMode" aria-label="Selecciona tu medio de transporte preferido">
                                    <option value="">-- Selecciona un transporte --</option>
                                    <option value="driving">ğŸš— Auto (AutomÃ³vil)</option>
                                    <option value="transit">ğŸšŒ Transporte PÃºblico</option>
                                    <option value="bicycling">ğŸš´ Bicicleta</option>
                                    <option value="walking">ğŸš¶ A pie</option>
                                </select>
                                <small class="select-helper">Elige cÃ³mo prefieres desplazarte</small>
                            </div>
                            <div class="input-group">
                                <label for="maxDetour">DesvÃ­o mÃ¡ximo aceptable (minutos):</label>
                                <input type="number" id="maxDetour" value="10" min="0" max="60" step="5">
                                <small>Tiempo extra que estÃ¡s dispuesto a agregar para hacer tareas en el camino</small>
                            </div>
                            <button id="saveTransport" class="btn btn-primary">Guardar Preferencias</button>
                        </div>
                        <div id="transportInfo" class="info-box"></div>
                    </div>

                    <div class="card">
                        <h3>ğŸ¯ Preferencias de OptimizaciÃ³n</h3>

                        <div class="preferences-section">
                            <h4>ProgramaciÃ³n de Tareas</h4>
                            <div class="input-group">
                                <label for="prefStartTime">Hora de inicio preferida:</label>
                                <input type="time" id="prefStartTime" value="09:00">
                                <small>Hora a la que prefieres comenzar tus tareas del dÃ­a</small>
                            </div>
                            <div class="input-group">
                                <label for="prefEndTime">Hora de fin preferida:</label>
                                <input type="time" id="prefEndTime" value="18:00">
                                <small>Hora lÃ­mite para finalizar actividades</small>
                            </div>
                            <div class="input-group">
                                <label for="breakDuration">Tiempo de descanso entre tareas (minutos):</label>
                                <input type="number" id="breakDuration" value="15" min="0" max="60" step="5">
                                <small>Tiempo de margen/descanso entre actividades consecutivas</small>
                            </div>
                            <div class="input-group">
                                <label for="maxDailyTasks">MÃ¡ximo de tareas por dÃ­a:</label>
                                <input type="number" id="maxDailyTasks" value="8" min="1" max="20">
                            </div>
                        </div>

                        <div class="preferences-section">
                            <h4>Pesos de Prioridad</h4>
                            <small>Define quÃ© tan importante es cada nivel de prioridad en la optimizaciÃ³n</small>
                            <div class="input-group">
                                <label for="weightUrgent">ğŸ”´ Urgente:</label>
                                <input type="number" id="weightUrgent" value="5.0" min="1" max="10" step="0.5">
                            </div>
                            <div class="input-group">
                                <label for="weightHigh">ğŸŸ¡ Alta:</label>
                                <input type="number" id="weightHigh" value="3.0" min="1" max="10" step="0.5">
                            </div>
                            <div class="input-group">
                                <label for="weightNormal">ğŸŸ¢ Normal:</label>
                                <input type="number" id="weightNormal" value="2.0" min="1" max="10" step="0.5">
                            </div>
                            <div class="input-group">
                                <label for="weightLow">ğŸ”µ Baja:</label>
                                <input type="number" id="weightLow" value="1.0" min="1" max="10" step="0.5">
                            </div>
                        </div>

                        <div class="preferences-section">
                            <h4>Opciones de OptimizaciÃ³n</h4>
                            <label class="checkbox-label">
                                <input type="checkbox" id="locationClustering" checked>
                                <span>ğŸ“ Agrupar tareas cercanas</span>
                            </label>
                            <div class="input-group" style="margin-left: 25px;">
                                <label for="clusterRadius">Radio de agrupaciÃ³n (metros):</label>
                                <input type="number" id="clusterRadius" value="2000" min="500" max="10000" step="500">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="minimizeTravel" checked>
                                <span>ğŸš— Minimizar tiempo de viaje</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="respectDeadlines" checked>
                                <span>â° Respetar fechas lÃ­mite</span>
                            </label>
                        </div>

                        <button id="savePreferences" class="btn btn-success btn-large">Guardar Preferencias</button>
                        <div id="preferencesInfo" class="info-box"></div>
                    </div>

                    <div class="card">
                        <h3>ğŸ” Tipos de Lugares de InterÃ©s</h3>
                        <div class="poi-types">
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="supermercado" checked>
                                <span>ğŸ›’ Supermercados</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="farmacia" checked>
                                <span>ğŸ’Š Farmacias</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="banco" checked>
                                <span>ğŸ¦ Bancos/Cajeros</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="gasolinera">
                                <span>â›½ Gasolineras</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="correo">
                                <span>ğŸ“® Oficinas de Correo</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="poi-type" value="tienda">
                                <span>ğŸª Tiendas de Conveniencia</span>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- Route Planner View -->
                <section id="viewRoutePlanner" class="content-view">
                    <h2>ğŸ—ºï¸ Planificador de Rutas</h2>

                    <div class="card">
                        <h3>Planificar Ruta Optimizada</h3>
                        <div class="route-planner-controls">
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="routeOrigin">ğŸ“ Punto de Origen</label>
                                    <select id="routeOrigin" aria-label="Selecciona tu punto de origen">
                                        <option value="">-- Selecciona un origen --</option>
                                        <option value="home">ğŸ  Casa</option>
                                        <option value="work">ğŸ’¼ Trabajo</option>
                                        <option value="current">ğŸ“ Mi ubicaciÃ³n actual</option>
                                    </select>
                                    <small class="select-helper">Elige dÃ³nde comienza tu ruta</small>
                                </div>
                                <div class="input-group">
                                    <label for="routeDestination">ğŸ¯ Punto de Destino</label>
                                    <select id="routeDestination" aria-label="Selecciona tu punto de destino">
                                        <option value="">-- Selecciona un destino --</option>
                                        <option value="work">ğŸ’¼ Trabajo</option>
                                        <option value="home">ğŸ  Casa</option>
                                    </select>
                                    <small class="select-helper">Elige dÃ³nde termina tu ruta</small>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="routeTime">Hora estimada de salida:</label>
                                <input type="time" id="routeTime" value="08:00">
                            </div>
                            <button id="calculateRoute" class="btn btn-success btn-large">ğŸ” Buscar Ruta Optimizada</button>
                        </div>
                    </div>

                    <div id="routeResults" class="route-results" style="display:none;">
                        <div class="card">
                            <h3>ğŸ“ Ruta Sugerida</h3>
                            <div id="routeMap" class="route-map-container"></div>
                            <div id="routeSummary" class="route-summary"></div>
                        </div>

                        <div class="card">
                            <h3>ğŸ›ï¸ Lugares en la Ruta</h3>
                            <div id="poisOnRoute" class="pois-list"></div>
                        </div>

                        <div class="card">
                            <h3>âœ… Tareas que puedes hacer en el camino</h3>
                            <div id="tasksOnRoute" class="tasks-on-route"></div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="modal-content">
            <button type="button" class="close" aria-label="Cerrar ayuda">&times;</button>
            <h2 id="helpModalTitle">ğŸš€ CÃ³mo Usar el Calendario Inteligente</h2>

            <div class="help-section">
                <h3>1ï¸âƒ£ Configurar Ubicaciones ğŸ“</h3>
                <ol>
                    <li>Ve a <strong>"âš™ï¸ ConfiguraciÃ³n"</strong></li>
                    <li>Escribe tu direcciÃ³n de casa (aparecerÃ¡n sugerencias)</li>
                    <li>O usa <strong>"ğŸ“ Detectar mi ubicaciÃ³n actual"</strong> con GPS</li>
                    <li>Repite para tu trabajo</li>
                    <li>Haz clic en <strong>"ğŸš— Calcular automÃ¡ticamente"</strong> para tiempos de traslado</li>
                    <li>Guarda con el botÃ³n verde</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>2ï¸âƒ£ Configurar Horario Laboral â°</h3>
                <ol>
                    <li>En ConfiguraciÃ³n, ajusta tu hora de inicio (ej: 08:00)</li>
                    <li>Ajusta tu hora de fin (ej: 17:30)</li>
                    <li>Haz clic en <strong>"Guardar Horario"</strong></li>
                </ol>
            </div>

            <div class="help-section">
                <h3>3ï¸âƒ£ Agregar Tareas â•</h3>
                <ol>
                    <li>Ve a la vista <strong>"âœ“ Tareas"</strong></li>
                    <li>Completa el formulario con nombre, duraciÃ³n, ubicaciÃ³n, etc.</li>
                    <li>Haz clic en <strong>"AÃ±adir Tarea"</strong></li>
                </ol>
            </div>

            <div class="help-section">
                <h3>4ï¸âƒ£ Ver Sugerencias ğŸ’¡</h3>
                <p>En el Dashboard, la app te sugiere automÃ¡ticamente:</p>
                <ul>
                    <li><strong>ğŸ—ºï¸ Tareas cercanas</strong>: Agrupa tareas a menos de 2km</li>
                    <li><strong>âš ï¸ Tareas urgentes</strong>: Prioriza lo importante</li>
                    <li><strong>â° Fechas lÃ­mite</strong>: Te alerta cuando se acercan</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>ğŸ’¡ Atajos de Teclado</h3>
                <ul>
                    <li><strong>G + D</strong>: Ir al Dashboard</li>
                    <li><strong>G + C</strong>: Ir al Calendario</li>
                    <li><strong>G + T</strong>: Ir a Tareas</li>
                    <li><strong>?</strong>: Mostrar ayuda</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal Flotante para Tareas -->
    <div id="taskModal" class="task-modal" role="dialog" aria-modal="true" aria-labelledby="taskModalTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="task-modal-content">
            <div class="task-modal-header">
                <h3 id="taskModalTitle">â• Nueva Tarea</h3>
                <button type="button" class="task-modal-close" aria-label="Cerrar formulario de tarea" onclick="closeTaskModal()">âœ•</button>
            </div>

            <form id="taskModalForm" class="task-modal-form">
                <input type="hidden" id="modalTaskId">
                <input type="hidden" id="modalTaskPlaceId">

                <div class="form-group">
                    <label for="modalTaskName">Nombre de la tarea:</label>
                    <input type="text" id="modalTaskName" placeholder="Ej: Comprar verduras" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="modalTaskDuration">DuraciÃ³n (horas):</label>
                        <input type="number" id="modalTaskDuration" min="0.25" max="24" step="0.25" value="1" required>
                    </div>

                    <div class="form-group">
                        <label for="modalTaskPriority">âš¡ Prioridad</label>
                        <select id="modalTaskPriority" required aria-label="Selecciona la prioridad de la tarea">
                            <option value="baja">ğŸŸ¢ Baja</option>
                            <option value="media" selected>ğŸŸ¡ Media</option>
                            <option value="alta">ğŸŸ  Alta</option>
                            <option value="urgente">ğŸ”´ Urgente</option>
                        </select>
                    </div>
                </div>

                <div class="form-group autocomplete-wrapper">
                    <label for="modalTaskLocation">UbicaciÃ³n/Lugar:</label>
                    <input type="text" id="modalTaskLocation" placeholder="Ej: Supermercado Centro" required autocomplete="off">
                    <div id="modalTaskLocationSuggestions" class="autocomplete-suggestions"></div>
                    <button type="button" id="selectFromMapModal" class="btn btn-secondary btn-sm" style="margin-top: 8px;">
                        ğŸ“ Seleccionar en el mapa
                    </button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="modalTaskDate">Fecha (opcional):</label>
                        <input type="date" id="modalTaskDate">
                    </div>

                    <div class="form-group">
                        <label for="modalTaskTime">Hora (opcional):</label>
                        <input type="time" id="modalTaskTime" step="900">
                    </div>
                </div>

                <div class="form-group">
                    <label for="modalTaskDeadline">Fecha lÃ­mite (opcional):</label>
                    <input type="date" id="modalTaskDeadline">
                </div>

                <div class="form-group">
                    <label for="modalTaskStatus">ğŸ“‹ Estado de la Tarea</label>
                    <select id="modalTaskStatus" aria-label="Selecciona el estado de la tarea">
                        <option value="active">âœ… Activa</option>
                        <option value="pending">â³ Pendiente</option>
                        <option value="archived">ğŸ“¦ Archivada</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label" style="margin-top: 8px;">
                        <input type="checkbox" id="modalTaskIsFixed">
                        <span>ğŸ“Œ Tarea fija (no se puede mover durante la optimizaciÃ³n)</span>
                    </label>
                    <small style="margin-left: 28px; display: block; margin-top: 4px;">
                        Las tareas fijas mantienen su horario asignado en el calendario y no se reorganizan automÃ¡ticamente durante la optimizaciÃ³n
                    </small>
                </div>

                <div class="task-modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancelar</button>
                    <button type="button" id="btnDeleteTask" class="btn btn-danger" onclick="deleteTaskFromModal()" style="display: none;">
                        ğŸ—‘ï¸ Eliminar
                    </button>
                    <button type="button" id="btnArchiveTask" class="btn btn-warning" onclick="archiveTaskFromModal()" style="display: none;">
                        ğŸ“¦ Archivar
                    </button>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Modal de SelecciÃ³n de UbicaciÃ³n en Mapa -->
    <div id="mapPickerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mapPickerTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="mapPickerTitle">ğŸ“ Seleccionar UbicaciÃ³n en el Mapa</h2>
                <button type="button" class="close" aria-label="Cerrar selector de mapa" onclick="closeMapPickerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="map-picker-instructions">
                    <p>Haz clic en el mapa para seleccionar una ubicaciÃ³n o busca un lugar especÃ­fico.</p>
                </div>
                <div class="map-picker-search">
                    <input type="text" id="mapSearchInput" class="map-search-input" placeholder="Buscar lugar o direcciÃ³n..." autocomplete="off">
                    <div id="mapSearchSuggestions" class="autocomplete-suggestions"></div>
                </div>
                <div style="position: relative;">
                    <div id="mapPickerContainer" class="map-picker-container"></div>
                    <div class="map-legend">
                        <div class="map-legend-item">
                            <div class="map-legend-dot red"></div>
                            <span>Tu selecciÃ³n</span>
                        </div>
                        <div class="map-legend-item">
                            <div class="map-legend-dot blue"></div>
                            <span>Lugares cercanos</span>
                        </div>
                        <div class="map-legend-item">
                            <div class="map-legend-dot green"></div>
                            <span>Tus tareas</span>
                        </div>
                    </div>
                </div>
                <div id="selectedLocationInfo" class="selected-location-info" style="display: none;">
                    <strong>UbicaciÃ³n seleccionada:</strong>
                    <p id="selectedLocationName"></p>
                    <p id="selectedLocationCoords" style="font-size: 12px; color: var(--text-muted);"></p>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeMapPickerModal()">Cancelar</button>
                    <button id="btnConfirmLocation" class="btn btn-success" onclick="confirmMapLocation()" disabled>
                        âœ… Confirmar UbicaciÃ³n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Recomendaciones de Rutas -->
    <div id="routeRecommendationsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="routeRecommendationsTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="routeRecommendationsTitle">ğŸ—ºï¸ Recomendaciones de Rutas para Hoy</h2>
                <button type="button" class="close" aria-label="Cerrar recomendaciones de rutas" onclick="closeRouteRecommendationsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="routeRecommendationsList" class="route-recommendations-list">
                    <!-- Se llenarÃ¡ dinÃ¡micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles de Ruta -->
    <div id="routeDetailsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="routeDetailsTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="routeDetailsTitle">ğŸš— Planifica tu Ruta</h2>
                <button type="button" class="close" aria-label="Cerrar detalles de ruta" onclick="closeRouteDetailsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="transport-selector">
                    <h3>Selecciona tu mÃ©todo de transporte:</h3>
                    <div class="transport-options-grid">
                        <button class="transport-option" data-mode="driving" onclick="selectTransportMode('driving')">
                            <span class="transport-icon">ğŸš—</span>
                            <span class="transport-label">Auto</span>
                        </button>
                        <button class="transport-option" data-mode="transit" onclick="selectTransportMode('transit')">
                            <span class="transport-icon">ğŸšŒ</span>
                            <span class="transport-label">Transporte PÃºblico</span>
                        </button>
                        <button class="transport-option" data-mode="bicycling" onclick="selectTransportMode('bicycling')">
                            <span class="transport-icon">ğŸš´</span>
                            <span class="transport-label">Bicicleta</span>
                        </button>
                        <button class="transport-option" data-mode="walking" onclick="selectTransportMode('walking')">
                            <span class="transport-icon">ğŸš¶</span>
                            <span class="transport-label">Caminando</span>
                        </button>
                    </div>
                </div>

                <!-- Mapa Interactivo -->
                <div class="route-map-section">
                    <div class="route-map-header">
                        <h3>ğŸ—ºï¸ VisualizaciÃ³n de Ruta</h3>
                        <div class="map-controls">
                            <button id="btnToggleTraffic" class="btn-map-control" onclick="toggleTrafficLayer()" title="Mostrar/Ocultar TrÃ¡fico">
                                ğŸš¦ TrÃ¡fico
                            </button>
                            <button id="btnMyLocation" class="btn-map-control" onclick="centerMapOnUserLocation()" title="Mi UbicaciÃ³n">
                                ğŸ“ Mi UbicaciÃ³n
                            </button>
                        </div>
                    </div>
                    <div id="routeMapContainer" class="route-map-container"></div>
                    <div id="routeSummaryInfo"></div>
                </div>

                <div id="routeDetailsContent" class="route-details-content">
                    <div class="loading-message">
                        <p>Selecciona un mÃ©todo de transporte para calcular la ruta</p>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeRouteDetailsModal()">Cancelar</button>
                    <button id="btnApplyRoute" class="btn btn-success" onclick="applySelectedRoute()" style="display: none;">
                        âœ… Aplicar Esta Ruta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Desbordamiento de Tareas -->
    <div id="overflowModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="overflowModalTitle" aria-hidden="true" hidden tabindex="-1">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="overflowModalTitle">âš ï¸ Tareas que No Caben en el DÃ­a Seleccionado</h2>
                <button type="button" class="close" aria-label="Cerrar modal de desbordamiento" onclick="closeOverflowModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="overflow-info">
                    <p>Las siguientes tareas no pudieron ser asignadas porque el dÃ­a estÃ¡ lleno:</p>
                </div>

                <div id="overflowTasksList" class="overflow-tasks-list">
                    <!-- Se llenarÃ¡ dinÃ¡micamente -->
                </div>

                <div class="overflow-suggestions">
                    <h3>ğŸ“… DÃ­as Alternativos Sugeridos</h3>
                    <p>Estos dÃ­as tienen suficiente tiempo disponible para las tareas pendientes:</p>
                    <div id="overflowSuggestionsList" class="suggestions-grid">
                        <!-- Se llenarÃ¡ dinÃ¡micamente -->
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeOverflowModal()">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FullCalendar JS with fallback -->
    <script>
        (function loadFullCalendarWithFallback() {
            const cdns = [
                'https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js',
                'https://unpkg.com/fullcalendar@5.11.3/main.min.js'
            ];
            function loadNext(i) {
                if (i >= cdns.length) {
                    console.error('No se pudo cargar FullCalendar desde CDNs');
                    return;
                }
                const s = document.createElement('script');
                s.src = cdns[i];
                s.async = false;
                s.onload = () => { console.log('FullCalendar cargado desde', cdns[i]); };
                s.onerror = () => { loadNext(i + 1); };
                document.head.appendChild(s);
            }
            loadNext(0);
        })();
    </script>

    <!-- ConfiguraciÃ³n: Carga config.js (local) o config.public.js (GitHub Pages) -->
    <script>
        (function() {
            const isGitHubPages = window.location.hostname.includes('github.io');
            const configFile = isGitHubPages ? 'config.public.js' : 'config.js';

            const script = document.createElement('script');
            script.src = configFile;
            script.onerror = function() {
                // Si config.js no existe (local), intentar con config.public.js
                if (configFile === 'config.js') {
                    console.warn('âš ï¸ config.js no encontrado, cargando config.public.js');
                    const fallbackScript = document.createElement('script');
                    fallbackScript.src = 'config.public.js';
                    fallbackScript.onerror = function() {
                        console.error('âŒ No se pudo cargar ningÃºn archivo de configuraciÃ³n');
                    };
                    document.head.appendChild(fallbackScript);
                }
            };
            document.head.appendChild(script);

            console.log(`ğŸ“¦ Cargando configuraciÃ³n: ${configFile}`);
        })();
    </script>

    <!-- Google Maps JavaScript API con Places Library -->
    <script>
        (function() {
            // Esperar a que APP_CONFIG estÃ© disponible
            function loadGoogleMaps() {
                if (window.APP_CONFIG && window.APP_CONFIG.useGoogleMaps && window.APP_CONFIG.googleMapsFrontendKey) {
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${window.APP_CONFIG.googleMapsFrontendKey}&libraries=places&language=es&loading=async`;
                    script.async = true;
                    script.defer = true;
                    script.onload = () => console.log('âœ… Google Maps JavaScript API cargada');
                    script.onerror = () => console.error('âŒ Error cargando Google Maps JavaScript API');
                    document.head.appendChild(script);
                } else {
                    console.log('â„¹ï¸ Google Maps desactivado o sin API key - usando Nominatim');
                }
            }

            // Intentar cargar inmediatamente
            if (window.APP_CONFIG) {
                loadGoogleMaps();
            } else {
                // Si no estÃ¡ disponible, esperar un poco
                setTimeout(function checkConfig() {
                    if (window.APP_CONFIG) {
                        loadGoogleMaps();
                    } else {
                        setTimeout(checkConfig, 100);
                    }
                }, 100);
            }
        })();
    </script>

    <!-- Cargar scripts de la aplicaciÃ³n -->
    <script src="google-maps-api.js"></script>
    <script src="mapa-ruta.js"></script>
    <script src="sidebar-collapse.js"></script>
    <script src="map-picker-fixed.js"></script>
    <script src="app.js"></script>

    <!-- Floating Action Button (FAB) - Solo visible en mÃ³vil -->
    <button id="fabNewTask" class="mdc-fab fab-enter" aria-label="Nueva tarea">
        <div class="mdc-fab__ripple"></div>
        <span class="mdc-fab__icon">â•</span>
    </button>

    <script src="fab.js"></script>
</body>
</html>
